<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multiple Resizable Grids</title>
    <style>
        .resizable-grid {
            display: flex;
            flex-direction: column;
            width: 100%;
            overflow: hidden;
        }

        .resizable-grid>* {
            display: flex;
            flex-direction: row;
            width: 100%;
        }

        .resizable-grid>*>* {
            overflow: auto;
            box-sizing: border-box;
            flex-shrink: 0;
        }

        [role="separator"][aria-orientation="vertical"] {
            width: 4px;
            background: #aaa;
            cursor: col-resize;
            flex-shrink: 0;
        }

        [role="separator"][aria-orientation="horizontal"] {
            height: 4px;
            background: #aaa;
            cursor: row-resize;
            flex-shrink: 0;
        }
    </style>
</head>

<body>

    <div class="resizable-grid" style="height: 400px;">
        <div>
            <div style="width: 33%;">Grid 1 - Top Left</div>
            <div role="separator" aria-orientation="vertical"></div>
            <div style="width: 33%;">Grid 1 - Top Middle</div>
            <div role="separator" aria-orientation="vertical"></div>
            <div style="width: 33%;">Grid 1 - Top Right</div>
        </div>
        <div role="separator" aria-orientation="horizontal"></div>
        <div>
            <div style="width: 50%;">Grid 1 - Bottom Left</div>
            <div role="separator" aria-orientation="vertical"></div>
            <div style="width: 50%;">Grid 1 - Bottom Right</div>
        </div>
    </div>

    <div class="resizable-grid" style="height: 300px;">
        <div>
            <div style="width: 30%;">Grid 2 - Top Left</div>
            <div role="separator" aria-orientation="vertical"></div>
            <div style="width: 70%;">Grid 2 - Top Right</div>
        </div>
        <div role="separator" aria-orientation="horizontal"></div>
        <div>
            <div style="width: 100%;">Grid 2 - Full Width Column</div>
        </div>
    </div>

    <script>
        function setRowHeightsForAllGrids() {
            document.querySelectorAll('.resizable-grid').forEach(grid => {
                const children = Array.from(grid.children).filter(
                    el => !el.matches('[role="separator"][aria-orientation="horizontal"]')
                );
                const rowHeightPercent = 100 / children.length;
                children.forEach(row => {
                    row.style.height = `${rowHeightPercent}%`;
                });
            });
        }

        function initVerticalDrag(bar, leftPanel, rightPanel) {
            let isDragging = false;

            bar.addEventListener('mousedown', (e) => {
                e.preventDefault();
                isDragging = true;
                document.body.style.userSelect = 'none';
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;

                const container = bar.parentElement;
                const rect = container.getBoundingClientRect();
                const pointerX = e.clientX - rect.left;

                const leftRect = leftPanel.getBoundingClientRect();
                const rightRect = rightPanel.getBoundingClientRect();

                const leftStart = leftRect.left - rect.left;
                const totalWidth = leftRect.width + rightRect.width;
                const newLeftWidth = pointerX - leftStart;
                const min = 50;

                if (newLeftWidth > min && newLeftWidth < totalWidth - min) {
                    const containerWidth = container.offsetWidth;
                    leftPanel.style.width = (newLeftWidth / containerWidth) * 100 + '%';
                    rightPanel.style.width = ((totalWidth - newLeftWidth) / containerWidth) * 100 + '%';
                }
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
                document.body.style.userSelect = '';
            });
        }

        function initHorizontalDrag(bar, topRow, bottomRow, grid) {
            let isDragging = false;

            bar.addEventListener('mousedown', (e) => {
                e.preventDefault();
                isDragging = true;
                document.body.style.userSelect = 'none';
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;

                const rect = grid.getBoundingClientRect();
                const pointerY = e.clientY - rect.top;

                const totalHeight = rect.height;
                const newTopHeight = pointerY;
                const min = 50;

                if (newTopHeight > min && newTopHeight < totalHeight - min) {
                    const topPercent = (newTopHeight / totalHeight) * 100;
                    const bottomPercent = 100 - topPercent;

                    topRow.style.height = `${topPercent}%`;
                    bottomRow.style.height = `${bottomPercent}%`;
                }
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
                document.body.style.userSelect = '';
            });
        }

        function initAllGrids() {
            setRowHeightsForAllGrids();

            document.querySelectorAll('.resizable-grid').forEach(grid => {
                const children = Array.from(grid.children).filter(
                    el => !el.matches('[role="separator"][aria-orientation="horizontal"]')
                );

                const hBars = grid.querySelectorAll('[role="separator"][aria-orientation="horizontal"]');

                // Horizontal drag
                hBars.forEach((bar, i) => {
                    if (children[i + 1]) {
                        initHorizontalDrag(bar, children[i], children[i + 1], grid);
                    }
                });

                // Vertical drag within each row
                children.forEach(row => {
                    const panels = Array.from(row.children).filter(
                        el => !el.matches('[role="separator"][aria-orientation="vertical"]')
                    );
                    const bars = row.querySelectorAll('[role="separator"][aria-orientation="vertical"]');
                    bars.forEach((bar, i) => {
                        if (panels[i + 1]) {
                            initVerticalDrag(bar, panels[i], panels[i + 1]);
                        }
                    });
                });
            });
        }

        document.addEventListener('DOMContentLoaded', initAllGrids);
    </script>
</body>

</html>